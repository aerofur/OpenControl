@name OpenControl/config
@inputs 
@outputs [CONFIGURATION_DATA]:array [CONFIGURATION_CONTROL_DATA CONFIGURATION_ROUTING_DATA]:table
@persist ReverserF ReverserB IncreaseThrottle DecreaseThrottle IncreaseDynamics DecreaseDynamics IncreaseTrainBrake DecreaseTrainBrake IncreaseLocoBrake DecreaseLocoBrake SelectorUp SelectorDown
@persist HandBrake Sander Routing:table
@trigger none
@model
Controls = table()
if(dupefinished() | duped()){ reset() }
if(first()){ 

    # --// Control Stand //--
    
    #Reverser
    ReverserFS = ""
    ReverserNS = ""
    ReverserRS = ""
    
    #Throttle (Notch)
    ThrottleAdvance = ""
    ThrottleRetreat = ""
    
    #Dynamic (DynoNotch)
    DynamicThrottleAdvance = ""
    DynamicThrottleRetreat = ""
    
    # --// Air Brakes //--
    
    #Air Compressor
    Compressor_CFM = 254 
    MainReservoirVolume = 33.8
    CompressorStart = ""
    CompressorShutdown = ""

    #Automatic Brake Type
    AutomaticBrakeType = 0
    #0 = Westinghouse 26L
    #1 = Westinghouse 26C
    #2 = Westinghouse No. 6
    
    #Automatic Air Brake
    AutomaticApply = "opencontrol/airbrakes/26c/apply.wav"
    AutomaticRelease = "opencontrol/airbrakes/26c/release.wav"
    AutomaticEmergency = "opencontrol/airbrakes/26c/emergency_apply.wav"
    AutomaticEmergencyRelease = "opencontrol/airbrakes/26c/emergency_release.wav"
    
    #Independent Brake Type
    IndependentBrakeType = 0
    #0 = Westinghouse SA26
    #1 = Westinghouse S40F

    #Independent Air Brake
    IndependentApply = "opencontrol/airbrakes/sa26/apply.wav"
    IndependentRelease = "opencontrol/airbrakes/sa26/release.wav"
    IndependentBailOn = "opencontrol/airbrakes/sa26/bail_off2.wav"
    IndependentBailOff = "opencontrol/airbrakes/sa26/bail_on2.wav"

    # --// Locomotive Settings //--
    
    TractionMotor = "gsgtrainsounds/wheels/delco_d77.wav"
    RadiatorFanStart = "gsgtrainsounds/misc/delco_radfan_loop.wav"
    RadiatorFanEnd = "gsgtrainsounds/misc/delco_radfan_end.wav"
    DynamicFanStart = "gsgtrainsounds/misc/delco_dynfan_loop.wav"
    DynamicFanEnd = "gsgtrainsounds/misc/delco_dynfan_end.wav"
    
    BrakeSqueal = "gsgtrainsounds/wheels/brake_3_loud.wav"
    RollSoundWelded = "gsgtrainsounds/misc/wheels_welded.wav"
    RollSoundJointed = "gsgtrainsounds/misc/wheels_jointed.wav"

    AlarmBell = ""

    MaxGeneratorCurrent = 6000
    Motors = 6 #How many Traction Motors do you have?
    Axles = 6 #How many Axles do you have?

    MaxTractionMotorCurrent = 1500
    MaxContinuousTractionMotorCurrent = 1050
    TractionMotorType = 0 #0 for DC, 1 for AC
    MaxDynamicCurrent = 700
    MaxContinuousDynamicCurrent = 700

    EngineIdleRPM = 200 #Engine IDLE Rpm - (leave as default if you dont know)
    EngineRedlineRPM = 950 #Engine REDLINE (max) Rpm - (leave as default if you dont know)
    NumNotches = 8 #Number of Notchs your control stand has. For US equipment this is (mostly) 8.

    Horsepower = 3600 #Locomotive Horsepower
    Weight = 420000 #Locomotive Weight (in LB)

    BaseSpeed = 71 #The top speed that's considered "normal" for this locomotive.
    TopSpeed = 65 #Top Speed, in Miles per Hour, that the locomotive is capable of reaching due to the gearing. If you don't know, put 65.
    ClaspBrakes = 1 #Set to 1 if you have trucks fitted with Double Clasp or Triple Clasp brake cylinders.

    # --// Controls //--

    Shift = "lshift" #When pressing this key, all controls with "+Shift" next to them will be triggered, and all the other will be ignored.
    
    Controls["ReverserF",string] = "W"
    Controls["ReverserB",string] = "S"
    
    Controls["IncreaseThrottle",string] = "D"
    Controls["DecreaseThrottle",string] = "A"
    
    Controls["IncreaseDynamics",string] = "right"
    Controls["DecreaseDynamics",string] = "left"
    
    Controls["SelectorUp",string] = "rbracket +Shift"
    Controls["SelectorDown",string] = "lbracket +Shift"
    
    Controls["IncreaseTrainBrake",string] = "W +Shift"
    Controls["DecreaseTrainBrake",string] = "S +Shift"
    
    Controls["IncreaseLocoBrake",string] = "rbracket"
    Controls["DecreaseLocoBrake",string] = "lbracket"
    Controls["BailLocoBrake",string] = "slash"
    
    Controls["HandBrake",string] = "H"
    Controls["Sander",string] = "period"
    
    Controls["UseButton",string] = "mouse_left"
    
    LeverBased = 0 #0 for Control-Based, 1 for Lever-Based
    #When available, this enables the Lever-Based Control mode. This means that the key controls the LEVER, not the CONTROL.
    #For example consider a locomotive with a Selector Lever. Normally you'd press [IncreaseDynamics] to turn on the dynamic braking
    #With LeverBased mode, in order to turn on the dynamics you have to be in the "Off" selector notch and press [DecreaseTransition] to turn on the dynamics.


foreach(K,V:string = Controls){
    if(V:find(" +Shift")){
        Routing[K,number] = 1
        local EXP = V:explode(" ")
        Controls[K,string] = EXP[1,string]
    }
    else{
        Routing[K,number] = 0
    }
}
}
CONFIGURATION_DATA = array(Shift,LeverBased,ReverserFS,ReverserNS,ReverserRS,ThrottleAdvance,ThrottleRetreat,DynamicThrottleAdvance,DynamicThrottleRetreat,Compressor_CFM,MainReservoirVolume,
CompressorStart,CompressorShutdown,AutomaticApply,AutomaticRelease,AutomaticEmergency,AutomaticEmergencyRelease,IndependentApply,IndependentRelease,IndependentBailOn,IndependentBailOff,
AutomaticBrakeType,IndependentBrakeType,TractionMotor,RadiatorFanStart,RadiatorFanEnd,DynamicFanStart,DynamicFanEnd,BrakeSqueal,RollSoundWelded,RollSoundJointed,AlarmBell,
MaxGeneratorCurrent,Motors,Axles,MaxTractionMotorCurrent,MaxContinuousTractionMotorCurrent,TractionMotorType,MaxDynamicCurrent,MaxContinuousDynamicCurrent,EngineIdleRPM,
EngineRedlineRPM,NumNotches,Horsepower,Weight,BaseSpeed,TopSpeed,ClaspBrakes)

CONFIGURATION_CONTROL_DATA = Controls
CONFIGURATION_ROUTING_DATA = Routing
